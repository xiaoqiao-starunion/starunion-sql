数据需求
需求：采集异常玩家的采集数据
需求目的：根据异常数据进行补偿
筛选条件：指定玩家id
数据要求：
1.玩家蚁巢等级、语言
2.11月2日区战获得积分
3.11月2日区战领取奖励档位
4.11月2日18:30以前出发18:30以后返回的采集队伍的资源目标、及对应采集消耗的时间（一般不止一队）action_id可以标记往返
5.该次采集的前一次对相同资源点采集 消耗的时间和获取资源量


双倍奖励

select distinct role_id,tech_id
from log_tech
where tech_id in (7091900,7090300,7190900) and action in('6401','6402')
and created_at<=1635849000
and role_id in ('12673887', '8315740', '2780574', '16668035', '1914109', '7784815', '13232687', '15660314',
 '10344123', '16625882', '12900797', '13932509', '12946376', '14628324', '10488926', '2534465', 
 '13568996', '10641143', '12768301', '13933349', '13054020', '10518876', '8415821', '9274542',
 '8682290', '10863502', '9637422', '6806700', '8804435', '10807123', '9009726', '8164805',
 '8997621', '13432287', '8449748', '8392829', '18535393', '12707737', '19542821', '10056283', 
 '9173078', '17848388', '9203427', '16230383', '18028293', '17263352', '9697132', '9920817', 
 '10058774', '13672567', '13627466', '15984669', '7132320', '18485998', '9397710', '8323271', 
 '5306788', '5410147', '4568521', '4157875', '9744885', '5898245', '7970480', '9302618', '6319250',
'3478287', '10377761', '9842686', '5049824', '5425754', '4015057', '4157373', '4878458', '10836357', 
'4606583', '13618469', '17436476', '13538338', '13646957', '12013009', '5859464', '4868092', '7900360', 
'12003214', '4193468', '4988711', '13923802', '10383077', '12855863', '11554029', '2815092', '13062956', 
'11869709', '14812461', '12695431', '13570237', '7955918', '5651187', '8053817', '2386091', '4952440', 
'12464259', '5700519', '5663861', '5112364', '13208534', '6197467', '3356464', '3509982', '7312478',
 '3217012', '3182802', '12112268', '19006924', '5638768', '2234986', '15904317', '12082675', '13335916', 
'12899316', '11381605', '11338851', '12830732', '9011436', '1814380', '2545586', '2839632', '13442781',
  '13457416', '6333233', '7194666', '8069015', '6670584', '4838584', '4945254', '6364752', '6242375', 
  '11581990', '8846359', '7476248', '5796430', '7556919', '13808902', '5995791', '5864671', '7484888', 
  '7419026', '16305087', '4847066', '6948824', '3778012', '10967051', '3362012', '2785900', '5838840', 
  '2773242', '3428183', '17187493', '12971837', '3750961', '6394758', '5766059', '4387595', '3235284', 
  '15860282', '9392351', '13874038', '4169782', '5421816', '6882807', '4520034', '7107585', '3875892', 
  '5027622', '5869477', '4729172', '5035932', '8048568', '13985738', '18240901', '13307398', '5672697', 
  '6561978', '6054600', '4847830', '9746658', '6285596', '17362170', '17530403', '6567641', '7872253',
   '14071390', '10819745', '9709158', '12154893', '6891611', '12060709', '12781929', '10671725', 
   '11885565', '4861886', '4959391', '8381698', '18282699', '15208953', '8552934', '12706159',
    '11247443', '2236963', '5317835', '13653760', '3438250', '4037529', '11971786', '10572229', 
    '11248603', '12900787', '10384408', '5071083', '7461247', '2432566', '10773006', '5803286', 
    '16732058', '10110874', '5182575', '11369703', 
	'15201358', '10115333', '14592190', '1889531', '3038289', 
	'10006308', '10501726', '3657289', '12441258', '3615488', '10676122', '9510089', '8209907',
	 '11618741', '16839127', '9968827', '15389955', '8750388', '12957810', '8076641', '17573896', 
	 '9079279', '8462196', '17940565', '9074156', '9071574', '11498241')






select t1.role_id,t1.score,t2.max_award_node,t3.base_level,battle_id,get_time,last_get_time,nums
from
(
select role_id,sum(nums) as score
from log_activity_score
where 
ac_id = '1000300' and created_at>=1635811200 and created_at<1635897600
and role_id in 
('12673887', '8315740', '2780574', '16668035', '1914109', '7784815', '13232687', '15660314',
 '10344123', '16625882', '12900797', '13932509', '12946376', '14628324', '10488926', '2534465', 
 '13568996', '10641143', '12768301', '13933349', '13054020', '10518876', '8415821', '9274542',
 '8682290', '10863502', '9637422', '6806700', '8804435', '10807123', '9009726', '8164805',
 '8997621', '13432287', '8449748', '8392829', '18535393', '12707737', '19542821', '10056283', 
 '9173078', '17848388', '9203427', '16230383', '18028293', '17263352', '9697132', '9920817', 
 '10058774', '13672567', '13627466', '15984669', '7132320', '18485998', '9397710', '8323271', 
 '5306788', '5410147', '4568521', '4157875', '9744885', '5898245', '7970480', '9302618', '6319250',
'3478287', '10377761', '9842686', '5049824', '5425754', '4015057', '4157373', '4878458', '10836357', 
'4606583', '13618469', '17436476', '13538338', '13646957', '12013009', '5859464', '4868092', '7900360', 
'12003214', '4193468', '4988711', '13923802', '10383077', '12855863', '11554029', '2815092', '13062956', 
'11869709', '14812461', '12695431', '13570237', '7955918', '5651187', '8053817', '2386091', '4952440', 
'12464259', '5700519', '5663861', '5112364', '13208534', '6197467', '3356464', '3509982', '7312478',
 '3217012', '3182802', '12112268', '19006924', '5638768', '2234986', '15904317', '12082675', '13335916', 
'12899316', '11381605', '11338851', '12830732', '9011436', '1814380', '2545586', '2839632', '13442781',
  '13457416', '6333233', '7194666', '8069015', '6670584', '4838584', '4945254', '6364752', '6242375', 
  '11581990', '8846359', '7476248', '5796430', '7556919', '13808902', '5995791', '5864671', '7484888', 
  '7419026', '16305087', '4847066', '6948824', '3778012', '10967051', '3362012', '2785900', '5838840', 
  '2773242', '3428183', '17187493', '12971837', '3750961', '6394758', '5766059', '4387595', '3235284', 
  '15860282', '9392351', '13874038', '4169782', '5421816', '6882807', '4520034', '7107585', '3875892', 
  '5027622', '5869477', '4729172', '5035932', '8048568', '13985738', '18240901', '13307398', '5672697', 
  '6561978', '6054600', '4847830', '9746658', '6285596', '17362170', '17530403', '6567641', '7872253',
   '14071390', '10819745', '9709158', '12154893', '6891611', '12060709', '12781929', '10671725', 
   '11885565', '4861886', '4959391', '8381698', '18282699', '15208953', '8552934', '12706159',
    '11247443', '2236963', '5317835', '13653760', '3438250', '4037529', '11971786', '10572229', 
    '11248603', '12900787', '10384408', '5071083', '7461247', '2432566', '10773006', '5803286', 
    '16732058', '10110874', '5182575', '11369703', 
	'15201358', '10115333', '14592190', '1889531', '3038289', 
	'10006308', '10501726', '3657289', '12441258', '3615488', '10676122', '9510089', '8209907',
	 '11618741', '16839127', '9968827', '15389955', '8750388', '12957810', '8076641', '17573896', 
	 '9079279', '8462196', '17940565', '9074156', '9071574', '11498241')
group by role_id
)as t1
left join
( select  role_id,max(award_node) as max_award_node
from log_activity_award
where 
ac_id = '1000300' and created_at>=1635811200 and created_at<1635897600
and role_id in 
('12673887', '8315740', '2780574', '16668035', '1914109', '7784815', '13232687', '15660314',
 '10344123', '16625882', '12900797', '13932509', '12946376', '14628324', '10488926', '2534465', 
 '13568996', '10641143', '12768301', '13933349', '13054020', '10518876', '8415821', '9274542',
 '8682290', '10863502', '9637422', '6806700', '8804435', '10807123', '9009726', '8164805',
 '8997621', '13432287', '8449748', '8392829', '18535393', '12707737', '19542821', '10056283', 
 '9173078', '17848388', '9203427', '16230383', '18028293', '17263352', '9697132', '9920817', 
 '10058774', '13672567', '13627466', '15984669', '7132320', '18485998', '9397710', '8323271', 
 '5306788', '5410147', '4568521', '4157875', '9744885', '5898245', '7970480', '9302618', '6319250',
'3478287', '10377761', '9842686', '5049824', '5425754', '4015057', '4157373', '4878458', '10836357', 
'4606583', '13618469', '17436476', '13538338', '13646957', '12013009', '5859464', '4868092', '7900360', 
'12003214', '4193468', '4988711', '13923802', '10383077', '12855863', '11554029', '2815092', '13062956', 
'11869709', '14812461', '12695431', '13570237', '7955918', '5651187', '8053817', '2386091', '4952440', 
'12464259', '5700519', '5663861', '5112364', '13208534', '6197467', '3356464', '3509982', '7312478',
 '3217012', '3182802', '12112268', '19006924', '5638768', '2234986', '15904317', '12082675', '13335916', 
'12899316', '11381605', '11338851', '12830732', '9011436', '1814380', '2545586', '2839632', '13442781',
  '13457416', '6333233', '7194666', '8069015', '6670584', '4838584', '4945254', '6364752', '6242375', 
  '11581990', '8846359', '7476248', '5796430', '7556919', '13808902', '5995791', '5864671', '7484888', 
  '7419026', '16305087', '4847066', '6948824', '3778012', '10967051', '3362012', '2785900', '5838840', 
  '2773242', '3428183', '17187493', '12971837', '3750961', '6394758', '5766059', '4387595', '3235284', 
  '15860282', '9392351', '13874038', '4169782', '5421816', '6882807', '4520034', '7107585', '3875892', 
  '5027622', '5869477', '4729172', '5035932', '8048568', '13985738', '18240901', '13307398', '5672697', 
  '6561978', '6054600', '4847830', '9746658', '6285596', '17362170', '17530403', '6567641', '7872253',
   '14071390', '10819745', '9709158', '12154893', '6891611', '12060709', '12781929', '10671725', 
   '11885565', '4861886', '4959391', '8381698', '18282699', '15208953', '8552934', '12706159',
    '11247443', '2236963', '5317835', '13653760', '3438250', '4037529', '11971786', '10572229', 
    '11248603', '12900787', '10384408', '5071083', '7461247', '2432566', '10773006', '5803286', 
    '16732058', '10110874', '5182575', '11369703', 
	'15201358', '10115333', '14592190', '1889531', '3038289', 
	'10006308', '10501726', '3657289', '12441258', '3615488', '10676122', '9510089', '8209907',
	 '11618741', '16839127', '9968827', '15389955', '8750388', '12957810', '8076641', '17573896', 
	 '9079279', '8462196', '17940565', '9074156', '9071574', '11498241')
group by role_id
)as t2
on t1.role_id=t2.role_id
left join
(
  select tmp1.role_id,base_level,tmp1.battle_id,get_time,tmp2.action_id,last_get_time
  from
  (select d1.role_id,base_level,d1.battle_id
	,get_time --采集时间
	,d2.action_id,--上一次采集
	row_number() over(partition by d2.role_id order by finish_time desc) as rank --上一次采集
	from
	( --本次采集的时间
		select role_id,base_level,battle_id,sum(get_time) as get_time
		from
		( 
		select m1.base_level,m1.role_id,m1.battle_id,m1.action_id,DATE_FORMAT(FROM_UNIXTIME(created_at) AT TIME ZONE '+00:00', '%Y-%m-%d %H:%i:%s') return_time,
		DATE_FORMAT(FROM_UNIXTIME(finish_time) AT TIME ZONE '+00:00', '%Y-%m-%d %H:%i:%s') start_time,
		(created_at-finish_time)/60 as get_time
		from
		(
		select role_id,battle_id,action_id,finish_time,base_level
		from log_missions
		where category=3 and is_return=0
		 and created_at<=1635849000 --出发时间
		 and month=11
		 and role_id in 
		('12673887', '8315740', '2780574', '16668035', '1914109', '7784815', '13232687', '15660314',
		 '10344123', '16625882', '12900797', '13932509', '12946376', '14628324', '10488926', '2534465', 
		 '13568996', '10641143', '12768301', '13933349', '13054020', '10518876', '8415821', '9274542',
		 '8682290', '10863502', '9637422', '6806700', '8804435', '10807123', '9009726', '8164805',
		 '8997621', '13432287', '8449748', '8392829', '18535393', '12707737', '19542821', '10056283', 
		 '9173078', '17848388', '9203427', '16230383', '18028293', '17263352', '9697132', '9920817', 
		 '10058774', '13672567', '13627466', '15984669', '7132320', '18485998', '9397710', '8323271', 
		 '5306788', '5410147', '4568521', '4157875', '9744885', '5898245', '7970480', '9302618', '6319250',
		'3478287', '10377761', '9842686', '5049824', '5425754', '4015057', '4157373', '4878458', '10836357', 
		'4606583', '13618469', '17436476', '13538338', '13646957', '12013009', '5859464', '4868092', '7900360', 
		'12003214', '4193468', '4988711', '13923802', '10383077', '12855863', '11554029', '2815092', '13062956', 
		'11869709', '14812461', '12695431', '13570237', '7955918', '5651187', '8053817', '2386091', '4952440', 
		'12464259', '5700519', '5663861', '5112364', '13208534', '6197467', '3356464', '3509982', '7312478',
		 '3217012', '3182802', '12112268', '19006924', '5638768', '2234986', '15904317', '12082675', '13335916', 
		'12899316', '11381605', '11338851', '12830732', '9011436', '1814380', '2545586', '2839632', '13442781',
		  '13457416', '6333233', '7194666', '8069015', '6670584', '4838584', '4945254', '6364752', '6242375', 
		  '11581990', '8846359', '7476248', '5796430', '7556919', '13808902', '5995791', '5864671', '7484888', 
		  '7419026', '16305087', '4847066', '6948824', '3778012', '10967051', '3362012', '2785900', '5838840', 
		  '2773242', '3428183', '17187493', '12971837', '3750961', '6394758', '5766059', '4387595', '3235284', 
		  '15860282', '9392351', '13874038', '4169782', '5421816', '6882807', '4520034', '7107585', '3875892', 
		  '5027622', '5869477', '4729172', '5035932', '8048568', '13985738', '18240901', '13307398', '5672697', 
		  '6561978', '6054600', '4847830', '9746658', '6285596', '17362170', '17530403', '6567641', '7872253',
		   '14071390', '10819745', '9709158', '12154893', '6891611', '12060709', '12781929', '10671725', 
		   '11885565', '4861886', '4959391', '8381698', '18282699', '15208953', '8552934', '12706159',
		    '11247443', '2236963', '5317835', '13653760', '3438250', '4037529', '11971786', '10572229', 
		    '11248603', '12900787', '10384408', '5071083', '7461247', '2432566', '10773006', '5803286', 
		    '16732058', '10110874', '5182575', '11369703', 
			'15201358', '10115333', '14592190', '1889531', '3038289', 
			'10006308', '10501726', '3657289', '12441258', '3615488', '10676122', '9510089', '8209907',
			 '11618741', '16839127', '9968827', '15389955', '8750388', '12957810', '8076641', '17573896', 
			 '9079279', '8462196', '17940565', '9074156', '9071574', '11498241')
		 ) as m1
		inner join
		(select role_id,battle_id,created_at
		from log_missions
		where category=3 
		 and is_return=1
		 and created_at>1635849000 --返回出发时间
		 and month=11
		 and role_id in 
('12673887', '8315740', '2780574', '16668035', '1914109', '7784815', '13232687', '15660314',
 '10344123', '16625882', '12900797', '13932509', '12946376', '14628324', '10488926', '2534465', 
 '13568996', '10641143', '12768301', '13933349', '13054020', '10518876', '8415821', '9274542',
 '8682290', '10863502', '9637422', '6806700', '8804435', '10807123', '9009726', '8164805',
 '8997621', '13432287', '8449748', '8392829', '18535393', '12707737', '19542821', '10056283', 
 '9173078', '17848388', '9203427', '16230383', '18028293', '17263352', '9697132', '9920817', 
 '10058774', '13672567', '13627466', '15984669', '7132320', '18485998', '9397710', '8323271', 
 '5306788', '5410147', '4568521', '4157875', '9744885', '5898245', '7970480', '9302618', '6319250',
'3478287', '10377761', '9842686', '5049824', '5425754', '4015057', '4157373', '4878458', '10836357', 
'4606583', '13618469', '17436476', '13538338', '13646957', '12013009', '5859464', '4868092', '7900360', 
'12003214', '4193468', '4988711', '13923802', '10383077', '12855863', '11554029', '2815092', '13062956', 
'11869709', '14812461', '12695431', '13570237', '7955918', '5651187', '8053817', '2386091', '4952440', 
'12464259', '5700519', '5663861', '5112364', '13208534', '6197467', '3356464', '3509982', '7312478',
 '3217012', '3182802', '12112268', '19006924', '5638768', '2234986', '15904317', '12082675', '13335916', 
'12899316', '11381605', '11338851', '12830732', '9011436', '1814380', '2545586', '2839632', '13442781',
  '13457416', '6333233', '7194666', '8069015', '6670584', '4838584', '4945254', '6364752', '6242375', 
  '11581990', '8846359', '7476248', '5796430', '7556919', '13808902', '5995791', '5864671', '7484888', 
  '7419026', '16305087', '4847066', '6948824', '3778012', '10967051', '3362012', '2785900', '5838840', 
  '2773242', '3428183', '17187493', '12971837', '3750961', '6394758', '5766059', '4387595', '3235284', 
  '15860282', '9392351', '13874038', '4169782', '5421816', '6882807', '4520034', '7107585', '3875892', 
  '5027622', '5869477', '4729172', '5035932', '8048568', '13985738', '18240901', '13307398', '5672697', 
  '6561978', '6054600', '4847830', '9746658', '6285596', '17362170', '17530403', '6567641', '7872253',
   '14071390', '10819745', '9709158', '12154893', '6891611', '12060709', '12781929', '10671725', 
   '11885565', '4861886', '4959391', '8381698', '18282699', '15208953', '8552934', '12706159',
    '11247443', '2236963', '5317835', '13653760', '3438250', '4037529', '11971786', '10572229', 
    '11248603', '12900787', '10384408', '5071083', '7461247', '2432566', '10773006', '5803286', 
    '16732058', '10110874', '5182575', '11369703', 
	'15201358', '10115333', '14592190', '1889531', '3038289', 
	'10006308', '10501726', '3657289', '12441258', '3615488', '10676122', '9510089', '8209907',
	 '11618741', '16839127', '9968827', '15389955', '8750388', '12957810', '8076641', '17573896', 
	 '9079279', '8462196', '17940565', '9074156', '9071574', '11498241')
	) as m2 on m1.role_id=m2.role_id and m1.action_id=m2.action_id
	and m1.battle_id=m2.battle_id

	) as tmp
	group by role_id,battle_id,base_level
   ) as d1
	left join
	(  select role_id,battle_id,finish_time,action_id --取同对象的上次采集的battle_id
		from
		(
		select role_id,battle_id,action_id,finish_time
		from log_missions
		where category=3 and is_return=1
		 and finish_time<1635849000 --返回达到
		 and month>=10
		 and role_id in 
('12673887', '8315740', '2780574', '16668035', '1914109', '7784815', '13232687', '15660314',
 '10344123', '16625882', '12900797', '13932509', '12946376', '14628324', '10488926', '2534465', 
 '13568996', '10641143', '12768301', '13933349', '13054020', '10518876', '8415821', '9274542',
 '8682290', '10863502', '9637422', '6806700', '8804435', '10807123', '9009726', '8164805',
 '8997621', '13432287', '8449748', '8392829', '18535393', '12707737', '19542821', '10056283', 
 '9173078', '17848388', '9203427', '16230383', '18028293', '17263352', '9697132', '9920817', 
 '10058774', '13672567', '13627466', '15984669', '7132320', '18485998', '9397710', '8323271', 
 '5306788', '5410147', '4568521', '4157875', '9744885', '5898245', '7970480', '9302618', '6319250',
'3478287', '10377761', '9842686', '5049824', '5425754', '4015057', '4157373', '4878458', '10836357', 
'4606583', '13618469', '17436476', '13538338', '13646957', '12013009', '5859464', '4868092', '7900360', 
'12003214', '4193468', '4988711', '13923802', '10383077', '12855863', '11554029', '2815092', '13062956', 
'11869709', '14812461', '12695431', '13570237', '7955918', '5651187', '8053817', '2386091', '4952440', 
'12464259', '5700519', '5663861', '5112364', '13208534', '6197467', '3356464', '3509982', '7312478',
 '3217012', '3182802', '12112268', '19006924', '5638768', '2234986', '15904317', '12082675', '13335916', 
'12899316', '11381605', '11338851', '12830732', '9011436', '1814380', '2545586', '2839632', '13442781',
  '13457416', '6333233', '7194666', '8069015', '6670584', '4838584', '4945254', '6364752', '6242375', 
  '11581990', '8846359', '7476248', '5796430', '7556919', '13808902', '5995791', '5864671', '7484888', 
  '7419026', '16305087', '4847066', '6948824', '3778012', '10967051', '3362012', '2785900', '5838840', 
  '2773242', '3428183', '17187493', '12971837', '3750961', '6394758', '5766059', '4387595', '3235284', 
  '15860282', '9392351', '13874038', '4169782', '5421816', '6882807', '4520034', '7107585', '3875892', 
  '5027622', '5869477', '4729172', '5035932', '8048568', '13985738', '18240901', '13307398', '5672697', 
  '6561978', '6054600', '4847830', '9746658', '6285596', '17362170', '17530403', '6567641', '7872253',
   '14071390', '10819745', '9709158', '12154893', '6891611', '12060709', '12781929', '10671725', 
   '11885565', '4861886', '4959391', '8381698', '18282699', '15208953', '8552934', '12706159',
    '11247443', '2236963', '5317835', '13653760', '3438250', '4037529', '11971786', '10572229', 
    '11248603', '12900787', '10384408', '5071083', '7461247', '2432566', '10773006', '5803286', 
    '16732058', '10110874', '5182575', '11369703', 
	'15201358', '10115333', '14592190', '1889531', '3038289', 
	'10006308', '10501726', '3657289', '12441258', '3615488', '10676122', '9510089', '8209907',
	 '11618741', '16839127', '9968827', '15389955', '8750388', '12957810', '8076641', '17573896', 
	 '9079279', '8462196', '17940565', '9074156', '9071574', '11498241')
		 ) as m1
		
	) as d2 on d1.role_id=d2.role_id and d1.battle_id=d2.battle_id
	) as tmp1
    left join(
       --取采集时间
    	select role_id,battle_id,action_id,sum(last_get_time) as last_get_time
    	from
    	(
	select m1.role_id,m1.battle_id,m1.action_id,DATE_FORMAT(FROM_UNIXTIME(created_at) AT TIME ZONE '+00:00', '%Y-%m-%d %H:%i:%s') return_time,
	DATE_FORMAT(FROM_UNIXTIME(finish_time) AT TIME ZONE '+00:00', '%Y-%m-%d %H:%i:%s') start_time,
	(created_at-finish_time)/60 as last_get_time --上次采集的时间
	from
	(
	select role_id,battle_id,action_id,finish_time
	from log_missions
	where category=3 and is_return=0
	and role_id in ('12673887', '8315740', '2780574', '16668035', '1914109', '7784815', '13232687', '15660314',
 '10344123', '16625882', '12900797', '13932509', '12946376', '14628324', '10488926', '2534465', 
 '13568996', '10641143', '12768301', '13933349', '13054020', '10518876', '8415821', '9274542',
 '8682290', '10863502', '9637422', '6806700', '8804435', '10807123', '9009726', '8164805',
 '8997621', '13432287', '8449748', '8392829', '18535393', '12707737', '19542821', '10056283', 
 '9173078', '17848388', '9203427', '16230383', '18028293', '17263352', '9697132', '9920817', 
 '10058774', '13672567', '13627466', '15984669', '7132320', '18485998', '9397710', '8323271', 
 '5306788', '5410147', '4568521', '4157875', '9744885', '5898245', '7970480', '9302618', '6319250',
'3478287', '10377761', '9842686', '5049824', '5425754', '4015057', '4157373', '4878458', '10836357', 
'4606583', '13618469', '17436476', '13538338', '13646957', '12013009', '5859464', '4868092', '7900360', 
'12003214', '4193468', '4988711', '13923802', '10383077', '12855863', '11554029', '2815092', '13062956', 
'11869709', '14812461', '12695431', '13570237', '7955918', '5651187', '8053817', '2386091', '4952440', 
'12464259', '5700519', '5663861', '5112364', '13208534', '6197467', '3356464', '3509982', '7312478',
 '3217012', '3182802', '12112268', '19006924', '5638768', '2234986', '15904317', '12082675', '13335916', 
'12899316', '11381605', '11338851', '12830732', '9011436', '1814380', '2545586', '2839632', '13442781',
  '13457416', '6333233', '7194666', '8069015', '6670584', '4838584', '4945254', '6364752', '6242375', 
  '11581990', '8846359', '7476248', '5796430', '7556919', '13808902', '5995791', '5864671', '7484888', 
  '7419026', '16305087', '4847066', '6948824', '3778012', '10967051', '3362012', '2785900', '5838840', 
  '2773242', '3428183', '17187493', '12971837', '3750961', '6394758', '5766059', '4387595', '3235284', 
  '15860282', '9392351', '13874038', '4169782', '5421816', '6882807', '4520034', '7107585', '3875892', 
  '5027622', '5869477', '4729172', '5035932', '8048568', '13985738', '18240901', '13307398', '5672697', 
  '6561978', '6054600', '4847830', '9746658', '6285596', '17362170', '17530403', '6567641', '7872253',
   '14071390', '10819745', '9709158', '12154893', '6891611', '12060709', '12781929', '10671725', 
   '11885565', '4861886', '4959391', '8381698', '18282699', '15208953', '8552934', '12706159',
    '11247443', '2236963', '5317835', '13653760', '3438250', '4037529', '11971786', '10572229', 
    '11248603', '12900787', '10384408', '5071083', '7461247', '2432566', '10773006', '5803286', 
    '16732058', '10110874', '5182575', '11369703', 
	'15201358', '10115333', '14592190', '1889531', '3038289', 
	'10006308', '10501726', '3657289', '12441258', '3615488', '10676122', '9510089', '8209907',
	 '11618741', '16839127', '9968827', '15389955', '8750388', '12957810', '8076641', '17573896', 
	 '9079279', '8462196', '17940565', '9074156', '9071574', '11498241')
	 ) as m1
	inner join
	(select role_id,battle_id,action_id,created_at
	from log_missions
	where category=3 
	 and is_return=1
	 and role_id in 
('12673887', '8315740', '2780574', '16668035', '1914109', '7784815', '13232687', '15660314',
 '10344123', '16625882', '12900797', '13932509', '12946376', '14628324', '10488926', '2534465', 
 '13568996', '10641143', '12768301', '13933349', '13054020', '10518876', '8415821', '9274542',
 '8682290', '10863502', '9637422', '6806700', '8804435', '10807123', '9009726', '8164805',
 '8997621', '13432287', '8449748', '8392829', '18535393', '12707737', '19542821', '10056283', 
 '9173078', '17848388', '9203427', '16230383', '18028293', '17263352', '9697132', '9920817', 
 '10058774', '13672567', '13627466', '15984669', '7132320', '18485998', '9397710', '8323271', 
 '5306788', '5410147', '4568521', '4157875', '9744885', '5898245', '7970480', '9302618', '6319250',
'3478287', '10377761', '9842686', '5049824', '5425754', '4015057', '4157373', '4878458', '10836357', 
'4606583', '13618469', '17436476', '13538338', '13646957', '12013009', '5859464', '4868092', '7900360', 
'12003214', '4193468', '4988711', '13923802', '10383077', '12855863', '11554029', '2815092', '13062956', 
'11869709', '14812461', '12695431', '13570237', '7955918', '5651187', '8053817', '2386091', '4952440', 
'12464259', '5700519', '5663861', '5112364', '13208534', '6197467', '3356464', '3509982', '7312478',
 '3217012', '3182802', '12112268', '19006924', '5638768', '2234986', '15904317', '12082675', '13335916', 
'12899316', '11381605', '11338851', '12830732', '9011436', '1814380', '2545586', '2839632', '13442781',
  '13457416', '6333233', '7194666', '8069015', '6670584', '4838584', '4945254', '6364752', '6242375', 
  '11581990', '8846359', '7476248', '5796430', '7556919', '13808902', '5995791', '5864671', '7484888', 
  '7419026', '16305087', '4847066', '6948824', '3778012', '10967051', '3362012', '2785900', '5838840', 
  '2773242', '3428183', '17187493', '12971837', '3750961', '6394758', '5766059', '4387595', '3235284', 
  '15860282', '9392351', '13874038', '4169782', '5421816', '6882807', '4520034', '7107585', '3875892', 
  '5027622', '5869477', '4729172', '5035932', '8048568', '13985738', '18240901', '13307398', '5672697', 
  '6561978', '6054600', '4847830', '9746658', '6285596', '17362170', '17530403', '6567641', '7872253',
   '14071390', '10819745', '9709158', '12154893', '6891611', '12060709', '12781929', '10671725', 
   '11885565', '4861886', '4959391', '8381698', '18282699', '15208953', '8552934', '12706159',
    '11247443', '2236963', '5317835', '13653760', '3438250', '4037529', '11971786', '10572229', 
    '11248603', '12900787', '10384408', '5071083', '7461247', '2432566', '10773006', '5803286', 
    '16732058', '10110874', '5182575', '11369703', 
	'15201358', '10115333', '14592190', '1889531', '3038289', 
	'10006308', '10501726', '3657289', '12441258', '3615488', '10676122', '9510089', '8209907',
	 '11618741', '16839127', '9968827', '15389955', '8750388', '12957810', '8076641', '17573896', 
	 '9079279', '8462196', '17940565', '9074156', '9071574', '11498241')
	) as m2 
	on m1.role_id=m2.role_id and m1.action_id=m2.action_id
	and m1.battle_id=m2.battle_id

  ) as tmp
    group by  role_id,battle_id,action_id
 
    ) as tmp2
	on tmp1.role_id=tmp2.role_id 
  where rank=1 and tmp1.action_id=tmp2.action_id
)as t3 on t3.role_id=t1.role_id
left join
( select role_id,nums,action_id
	from log_resource
	where action='1518'
	and role_id in 
('12673887', '8315740', '2780574', '16668035', '1914109', '7784815', '13232687', '15660314',
 '10344123', '16625882', '12900797', '13932509', '12946376', '14628324', '10488926', '2534465', 
 '13568996', '10641143', '12768301', '13933349', '13054020', '10518876', '8415821', '9274542',
 '8682290', '10863502', '9637422', '6806700', '8804435', '10807123', '9009726', '8164805',
 '8997621', '13432287', '8449748', '8392829', '18535393', '12707737', '19542821', '10056283', 
 '9173078', '17848388', '9203427', '16230383', '18028293', '17263352', '9697132', '9920817', 
 '10058774', '13672567', '13627466', '15984669', '7132320', '18485998', '9397710', '8323271', 
 '5306788', '5410147', '4568521', '4157875', '9744885', '5898245', '7970480', '9302618', '6319250',
'3478287', '10377761', '9842686', '5049824', '5425754', '4015057', '4157373', '4878458', '10836357', 
'4606583', '13618469', '17436476', '13538338', '13646957', '12013009', '5859464', '4868092', '7900360', 
'12003214', '4193468', '4988711', '13923802', '10383077', '12855863', '11554029', '2815092', '13062956', 
'11869709', '14812461', '12695431', '13570237', '7955918', '5651187', '8053817', '2386091', '4952440', 
'12464259', '5700519', '5663861', '5112364', '13208534', '6197467', '3356464', '3509982', '7312478',
 '3217012', '3182802', '12112268', '19006924', '5638768', '2234986', '15904317', '12082675', '13335916', 
'12899316', '11381605', '11338851', '12830732', '9011436', '1814380', '2545586', '2839632', '13442781',
  '13457416', '6333233', '7194666', '8069015', '6670584', '4838584', '4945254', '6364752', '6242375', 
  '11581990', '8846359', '7476248', '5796430', '7556919', '13808902', '5995791', '5864671', '7484888', 
  '7419026', '16305087', '4847066', '6948824', '3778012', '10967051', '3362012', '2785900', '5838840', 
  '2773242', '3428183', '17187493', '12971837', '3750961', '6394758', '5766059', '4387595', '3235284', 
  '15860282', '9392351', '13874038', '4169782', '5421816', '6882807', '4520034', '7107585', '3875892', 
  '5027622', '5869477', '4729172', '5035932', '8048568', '13985738', '18240901', '13307398', '5672697', 
  '6561978', '6054600', '4847830', '9746658', '6285596', '17362170', '17530403', '6567641', '7872253',
   '14071390', '10819745', '9709158', '12154893', '6891611', '12060709', '12781929', '10671725', 
   '11885565', '4861886', '4959391', '8381698', '18282699', '15208953', '8552934', '12706159',
    '11247443', '2236963', '5317835', '13653760', '3438250', '4037529', '11971786', '10572229', 
    '11248603', '12900787', '10384408', '5071083', '7461247', '2432566', '10773006', '5803286', 
    '16732058', '10110874', '5182575', '11369703', 
	'15201358', '10115333', '14592190', '1889531', '3038289', 
	'10006308', '10501726', '3657289', '12441258', '3615488', '10676122', '9510089', '8209907',
	 '11618741', '16839127', '9968827', '15389955', '8750388', '12957810', '8076641', '17573896', 
	 '9079279', '8462196', '17940565', '9074156', '9071574', '11498241')
)as t4 on t3.role_id=t4.role_id
and t3.action_id=t4.action_id





